import{j as C,d as K,u as d,a as b,h as I}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458120.js";import{X as O,aq as E,m as A}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458123.js";import{j as i}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b764581.js";import{aF as T,t as D,aG as M,ax as R,ag as L,ak as U,ai as _,T as P,aH as $,aI as F,aj as z,ah as W,ae as q,U as x,I as k,C as j,N as J,W as h,R as G}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458111.js";import{S as H}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458135.js";import{b as V,a as X}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458136.js";import{C as Y}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458137.js";import{b as Q}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458138.js";import{h as Z,P as ee}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645819.js";import{W as S}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458119.js";import{c as v}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645818.js";const f=[{keys:[{key:"",compress:!1}],tag:"all",nome:"selectAllBackup",checked:!1,merge:!1,icon:i.jsx(T,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"respostasRapidas",compress:!0},{key:"respostasRapidasAcao",compress:!1},{key:"categoria",compress:!0},{key:"guardaMsg",compress:!0},{key:"medias",compress:!1}],tag:"respostasRapidas",nome:"quickReply",checked:!1,merge:!1,icon:i.jsx(D,{className:"w-6 h-6 fill-[var(--primaria)]"})},{keys:[{key:"agendamentos",compress:!1},{key:"agendamentosNaoDisparados",compress:!1},{key:"sendAfterWhatsAppOpens",compress:!0}],tag:"agendamentos",nome:"appointments",checked:!1,merge:!1,icon:i.jsx(M,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"crm",compress:!0}],tag:"crm",nome:"CRM",checked:!1,merge:!1,icon:i.jsx(Y,{size:"24px",color:"var(--primaria)"})},{keys:[{key:"contatos",compress:!0}],tag:"contatos",nome:"contacts",checked:!1,merge:!1,icon:i.jsx(V,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"notes",compress:!0}],tag:"notes",nome:"notes",checked:!1,merge:!1,icon:i.jsx(Z,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"notifications",compress:!0}],tag:"notifications",nome:"notifications",checked:!1,merge:!1,icon:i.jsx(H,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"perfil",compress:!0}],tag:"perfil",nome:"profile",checked:!1,merge:!1,icon:i.jsx(O,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"userTabs",compress:!0}],tag:"userTabs",nome:"userTabs",checked:!1,merge:!1,icon:i.jsx(R,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"agrupamentos",compress:!0},{key:"relatorio",compress:!0}],tag:"envioEmMassa",nome:"bulkSending",checked:!1,merge:!1,icon:i.jsx(X,{className:"w-6 h-6 fill-[var(--primaria)]"})},{keys:[{key:"encomendas",compress:!0}],tag:"encomendas",nome:"encomendas",checked:!1,merge:!1,icon:i.jsx(ee,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"autoatendimento",compress:!1}],tag:"autoatendimento",nome:"autoAtendimento",checked:!1,merge:!1,icon:i.jsx(L,{className:"text-[var(--primaria)]",size:24})},{keys:[{key:"replacementStorage",compress:!1}],tag:"replacementStorage",nome:"menuFooter_replace_text",checked:!1,merge:!1,icon:i.jsx(E,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"webhook",compress:!0}],tag:"webhook",nome:"webhook",checked:!1,merge:!1,disabledMerge:!0,icon:i.jsx(U,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"IA",compress:!0}],tag:"IA",nome:"IA",checked:!1,merge:!1,disabledMerge:!0,icon:i.jsx(Q,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"status",compress:!1}],tag:"status",nome:"status",checked:!1,merge:!1,icon:i.jsx(_,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"pinChat",compress:!0}],tag:"pinChat",nome:"fixContacts",checked:!1,merge:!1,icon:i.jsx(P,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"atendimento",compress:!0}],tag:"atendimento",nome:"finalizedOrTrasferAtt",checked:!1,merge:!1,disabledMerge:!0,icon:i.jsx($,{strokeWidth:.4,className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"backupAutomatico",compress:!0}],tag:"backupAutomatico",nome:"automaticBk",checked:!1,merge:!1,disabledMerge:!0,icon:i.jsx(F,{className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"whatsApi",compress:!0}],tag:"whatsApi",nome:"whatsApi",checked:!1,merge:!1,disabledMerge:!0,icon:i.jsx(z,{strokeWidth:.4,className:"w-6 h-6 text-[var(--primaria)]"})},{keys:[{key:"FollowUp",compress:!1}],tag:"FollowUp",nome:"followUp",checked:!1,merge:!1,icon:i.jsx(W,{className:"text-[var(--primaria)]",size:24})},{keys:[{key:"fluxo",compress:!0},{key:"fluxoFiles",compress:!1}],tag:"fluxo",nome:"fluxo",checked:!1,merge:!1,icon:i.jsx(q,{className:"text-[var(--primaria)]",size:24})}],te=v()((c,y)=>({backup:null,keys:[],getBackup:()=>chrome.storage.local.get(null,async e=>{const{language:s}=d.getState();try{const r=f.filter(a=>{if(a.tag==="all"||a.tag==="IA"&&e.IA&&e.IA.activeIA||a.tag==="atendimento"&&e.atendimento||a.tag==="backupAutomatico"&&e.backupAutomatico&&e.backupAutomatico.date.length>0)return!0;if(a.tag==="replacementStorage"&&e.replacementStorage){const t=e.replacementStorage;if(t.state&&Array.isArray(t.state.items)&&t.state.items.length>0||Array.isArray(t.items)&&t.items.length>0)return!0}return!!(a.tag==="whatsApi"&&e.whatsApi&&e.whatsApi.token.length>0||a.tag==="fluxo"&&e.fluxo&&e.fluxo.workflows.length>0||a.keys.find(t=>e[t.key]&&e[t.key].length>0))});c({keys:r,backup:e})}catch(r){console.error("Erro ao tentar capturar o backup",r),k({type:"Error",message:s.getBkError,position:"top-right"})}}),setActiveKey:(e,s)=>c(r=>({keys:r.keys.map(t=>e==="all"?{...t,checked:s}:t.tag===e?{...t,checked:s}:t.tag==="all"&&!s?{...t,checked:!1}:t)})),setActiveMerge:(e,s)=>c(r=>({keys:r.keys.map(t=>e==="all"?{...t,merge:s}:t.tag===e?{...t,merge:s}:t.tag==="all"&&!s?{...t,merge:!1}:t)})),clearState:()=>c({backup:null,keys:[]}),exportBackup:()=>{const{backup:e,keys:s,downloadBackup:r}=y(),{language:a}=d.getState(),{close:t,openRendertype:o}=A.getState(),{session:l}=b.getState();if(!s.find(u=>u.checked)){k({type:"Error",message:a.selectBkItemExport,position:"top-right"});return}if(!l.is_premium){o("user_free");return}const n={};for(let u of s)if(!(!u.checked||u.tag==="all"))for(let p of u.keys){let m=e[p.key];if(typeof m=="string")try{m=JSON.parse(m)}catch{}m&&typeof m=="object"&&"state"in m&&"version"in m&&(m=m.state),p.compress?n[p.key]=j.encryptData(m):n[p.key]=m}delete n.guardaMsg,delete n.medias,t(),r(n)},downloadBackup:e=>{const{whatsappID:s}=C.getState(),{config:r}=K.getState(),{language:a}=d.getState(),t=JSON.stringify(e),o=new Blob([t],{type:"application/json"}),{day:l,month:n,year:u}=x.dayDate(),{hours:p,minutes:m,seconds:N}=x.timeDate(),w=`backup_${l}-${n}-${u}_${p} ：${m} ：${N}.json`,g=document.createElement("a");g.setAttribute("href",URL.createObjectURL(o)),g.setAttribute("download",w),g.style.display="none",document.body.appendChild(g),g.click(),document.body.removeChild(g),k({type:"Success",message:a.backup_exportado,position:"top-right"}),(async()=>(await S.Chat("sendTxt",{id:s,msg:`*_${r.primeiroNome}:_*
 ${a.bkMessageSucess}`}),S.Chat("sendDoc",{id:s,base64:o,name:w})))()}})),B=v()((c,y)=>({automaticoBK:{date:"",time:"",recurrency:"",items:[]},createOrEditAttBk:{date:"",time:"",recurrency:"",items:[]},keys:f,startCreateOrEditAtt:()=>c(e=>{const s=f.map(r=>e.automaticoBK.items.length+1===f.reduce((a,t)=>a+t.keys.length,0)?{...r,checked:!0}:r.keys.find(a=>e.automaticoBK.items.includes(a.key))?{...r,checked:!0}:r);return{createOrEditAttBk:e.automaticoBK,keys:s}}),setCreateOrEditAttBk:e=>c(()=>({createOrEditAttBk:e})),setActiveKey:(e,s)=>c(r=>{const a=r.keys.map(o=>e==="all"?{...o,checked:s}:o.tag===e?{...o,checked:s}:o.tag==="all"&&!s?{...o,checked:!1}:o),t=a.reduce((o,l)=>(l.checked&&l.tag!=="all"&&o.push(...l.keys.map(n=>n.key)),o),[]);return{keys:a,createOrEditAttBk:{...r.createOrEditAttBk,items:t}}}),saveAutomaticoBK:()=>{const{createOrEditAttBk:e,keys:s}=y(),{language:r}=d.getState(),{close:a}=A.getState();if(!s.find(t=>t.checked)){k({type:"Error",message:r.bkAttNotItem,position:"top-right"});return}if(e.date.length<=0||e.time.length<=0){k({type:"Error",message:r.bkAttNotDateOrTime,position:"top-right"});return}h("backupAutomatico",e),c({automaticoBK:e,keys:f}),a(),k({type:"Success",message:r.autoBackupCreated,position:"top-right"})},removeAutomaticoBK:()=>c(()=>{const{close:e}=A.getState(),{language:s}=d.getState();return h("backupAutomatico",{date:"",time:"",recurrency:"",items:[]}),e(),k({type:"Success",message:s.autoBackupRemoved,position:"top-right"}),{automaticoBK:{date:"",time:"",recurrency:"",items:[]}}}),validateTimeoutBk:()=>{const{automaticoBK:e,exportBkAtt:s}=y();if(e.date.length<=0)return;if(x.Dois_min_differ(`${e.date} ${e.time}`)){s();let a=e;e.recurrency===""?a={...e,date:"",time:""}:a={...e,date:x.CalcularProximaData(new Date().toISOString().slice(0,10),e.recurrency)},c({automaticoBK:a}),h("backupAutomatico",a)}},exportBkAtt:()=>{const{automaticoBK:e}=y(),{downloadBackup:s}=te.getState(),{session:r}=b.getState(),{language:a}=d.getState(),t=I();if(!r.is_premium){J("backupAutomatico",a.btnPremium,t);return}chrome.storage.local.get([...e.items],o=>{const l={};for(const n of e.items)if(!(n==="IA"&&(!o.IA||!o.IA.activeIA))&&!(n==="atendimento"&&o.atendimento)&&!(!o[n]||o[n].length===0))for(const u of f){const p=u.keys.find(m=>m.key===n);p&&(p.compress?l[n]=j.encryptData(o[n]):l[n]=o[n])}s(l)})}}));(async()=>{const c=await G("backupAutomatico");c&&c.date.length>0&&B.setState({automaticoBK:c})})();const ke=c=>{B.setState({automaticoBK:c}),h("backupAutomatico",c)};chrome.runtime.onMessage.addListener(async c=>{switch(c.action){case"Update_BackupAutomatico":B.getState().validateTimeoutBk();break}});export{f as B,te as a,ke as b,B as u};
