import{i as L,b as R,c as D,d as S,e as P,a as g,u as A,f as U}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458120.js";import{i as x,u as W,a as y,S as G,b as N,c as O,d as B,g as z,e as V,f as J,h as H,j as K,k as Z,l as Q,m as f,n as X,o as Y,p as q,q as tt,r as et,A as at,t as ot,s as m}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458123.js";import{i as st,a as it}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458124.js";import{i as rt}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458125.js";import{i as nt}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458126.js";import{i as ct}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458127.js";import{i as lt}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458128.js";import{P as C}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458111.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458129.js";import{s as dt}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458130.js";import{i as pt}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458131.js";import{i as ut}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458132.js";import{j as u}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b764581.js";import{a as v}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645817.js";import{W as mt,V as k}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458119.js";import{d as gt,S as w}from"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458133.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645818.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645814.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645813.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645812.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458110.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645816.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b7645819.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458134.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458135.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458136.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458137.js";import"./v_7_4_3_14_49a76bb0-8cf2-4908-a016-18478b76458138.js";const ht=()=>{const t=document.createElement("script");t.src=chrome.runtime.getURL("whatsapp/index.iife.js"),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.remove()}},ft=(t,e,i=5e3)=>{const s=Date.now(),c=()=>{document.querySelector(t)?e():Date.now()-s>=i?(console.error(`Erro: O seletor "${t}" não foi encontrado dentro do tempo limite.`),e()):setTimeout(c,300)};c()};ft("#app .app-wrapper-web",()=>{ht()});L();R();D();(async()=>x())();function _t(t,e){const i=[],s=[],c=new Set(e.flatMap(o=>o.chats.map(r=>`${r.id}|${o.id}`))),a=new Set(t.flatMap(o=>o.chats.map(r=>`${r.id}|${o.id}`))),n=new Map(e.flatMap(o=>o.chats.map(r=>[`${r.id}|${o.id}`,{chat:r,tabId:o.id}]))),l=new Map(t.flatMap(o=>o.chats.map(r=>[`${r.id}|${o.id}`,{chat:r,tabId:o.id}])));for(const o of a)if(!c.has(o)){const r=l.get(o);r&&i.push({...r,chat:{...r.chat,id:C(r.chat.id)}})}for(const o of c)if(!a.has(o)){const r=n.get(o);r&&s.push({...r,chat:{...r.chat,id:C(r.chat.id)}})}return{chatsAdded:i,chatsRemoved:s}}async function E(t,e,i){for(const{chat:s,tabId:c}of t){const a=e.filter(n=>{const l=n.funil.abas.some(_=>_.id===c),o=s.id.endsWith("@g.us"),r=n.regras?.responderGrupos?.propriedades?.active!==!1;return l&&n.acionamento.type===i&&(!o||r)});for(const n of a)try{await G(s.id,n)}catch(l){console.error(`❌ Erro ao disparar follow-up: ${n.id} para chat: ${s.id}`,l)}}}function bt(t,e){t.forEach(({chat:i,tabId:s})=>{e.filter(a=>{const n=a.funil.abas.some(r=>r.id===s),l=i.id.endsWith("@g.us"),o=a.regras?.responderGrupos?.propriedades?.active!==!1;return n&&a.acionamento.type==="timing"&&(!l||o)}).forEach(a=>{y.getState().addChatToFollowUp(a.id,s,i,"tab")})})}function wt(t,e){t.forEach(({chat:i,tabId:s})=>{e.filter(a=>{const n=a.funil.abas.some(r=>r.id===s),l=i.id.endsWith("@g.us"),o=a.regras?.responderGrupos?.propriedades?.active!==!1;return n&&a.acionamento.type==="timing"&&(!l||o)}).forEach(a=>{y.getState().removeChatFromFollowUp(a.id,s,i.id,"tab")})})}function St(){return W.subscribe(async(e,i)=>{if(!e.userTabs||!y.getState().initSubscribeUserTabs)return;const s=e.userTabs||[],c=i.userTabs||[],a=y.getState().FollowUp.filter(d=>d.active);if(a.length===0)return;const n=c.filter(d=>!s.some(p=>p.id===d.id)),{chatsAdded:l,chatsRemoved:o}=_t(s,c),r=n.flatMap(d=>d.chats.map(p=>({chat:p,tabId:d.id}))),_=o.filter(d=>!r.some(p=>p.chat.id===d.chat.id));if(l.length>0){const d=a.filter(h=>h.acionamento.type==="dispararAoEntrar"),p=a.filter(h=>h.acionamento.type==="timing");d.length>0&&await E(l,d,"dispararAoEntrar"),p.length>0&&bt(l,p)}if(_.length>0){const d=a.filter(b=>b.acionamento.type==="dispararAoSair"),p=_.filter(b=>!n.some($=>$.id===b.tabId));d.length>0&&p.length>0&&await E(p,d,"dispararAoSair");const h=a.filter(b=>b.acionamento.type==="timing");h.length>0&&wt(_,h)}})}window.addEventListener("message",t=>{if(t.data.type==="Ev"&&t.data.action==="chat.update_label"){const e=JSON.parse(t.data.model);if(!e.chat||!e.chat.id)return;e.chat.id={server:"@"+e.chat.id.split("@")[1],user:e.chat.id.split("@")[0],_serialized:e.chat.id},N.getState().dispartWebhook(e.chat.id.user,"labels",{labels:e.labels,type:e.type})}t.data.type==="Ev"&&t.data.action==="chat.presence_change"&&JSON.parse(t.data.model)});O();B();st();it();z();V();rt();J();nt();ct();H();K();Z();lt();Q();St();dt({useModal:f,useModalOptions:X});const yt=S.subscribe(t=>({config:t.config}),({config:t})=>{chrome.storage.local.get(["initSystem","userTabs","guardaMsg"],e=>{if(!e.initSystem&&e.userTabs.length===0&&e.guardaMsg.length===0){const{openRendertype:i}=f.getState();["ahiieliljkcgmghicbgidblclkbklmka","likkccegmkoonimkjnmgpadngedknpdk","npcbkljcefmdegcjjghdfgfmnkmfjlba"].includes(t.chromeStoreID)||i("Modelo_Selecao",!1)}})},{fireImmediately:!0});window.addEventListener("beforeunload",()=>{yt()});window.addEventListener("message",async t=>{t.data.type==="Ev"&&t.data.action==="webpack.full_ready"&&(Y(),q(),await P(),pt(),await tt(),et(),ut())});const kt=()=>{const{openModal:t}=f.getState(),{session:e,user:i}=g.getState();if(!e.is_auth)return null;switch(e.user_status){case"test_finished":t({type:"not_structure",modal:u.jsx(w,{status:e.user_status})});break;case"canceled":t({type:"not_structure",modal:u.jsx(w,{status:e.user_status})});break;case"overdue":t({type:"not_structure",modal:u.jsx(w,{status:e.user_status})});break;case"suspended":t({type:"not_structure",modal:u.jsx(w,{status:e.user_status})});break;case"active":const s=gt(i.user_premium.data_liberacao);s<=15&&t({type:"not_structure",modal:u.jsx(w,{status:e.user_status,days:s})});break}},Tt=async()=>{await at(10);const{user:t,session:e,auth_google:i}=g.getState(),{user:s}=await mt.Conn("getMyDeviceId");return{user_id:t.user_id,name:t.name,email:t.email,email_auth:i.email_auth,whatsapp_plugin:s,user_premium:!!t.user_premium,user_status:e.user_status,navigator:navigator.userAgent,time:ot(),dataCadastro:t.dataCadastro,whatsapp_registro:t.whatsapp_registro,path:t.path,afiliado:t.afiliado,campanhaID:t.campanhaID,cookies:t?.cookies}},vt=async()=>{const{getWebhooks:t}=S.getState(),e=t("login_plugin"),i=new Date().getTime(),s=localStorage.getItem("8fd5ad24df1e1b800d670e563b1b83591980060a=="),c=24;if(s){const a=new Date(s).getTime();if((i-a)/(1e3*60*60)<c)return}if(localStorage.setItem("8fd5ad24df1e1b800d670e563b1b83591980060a==",new Date().toISOString()),e.active){const a=await Tt();v.post(e.link,a,{headers:{"Content-Type":"application/json"}})}kt()};async function T(){const{language:t}=A.getState(),{config:e}=S.getState(),{login:i,logout:s,session:c,user:a}=g.getState(),{openRendertype:n}=f.getState();if(c.is_auth)try{const l={email:a.email,access_token_plugin:a.access_token_plugin},o=(await v.post(`${k.backend_plugin}api/auth/validation/${e.chromeStoreID}`,l,{headers:{"Content-Type":"application/json",accept:"application/json","access-token":k.cript_key}})).data;if(o.success)i(o.user,o.auth_google,o.user_status);else if(o.msg_id==="invalid_token_in_validation")n("access_duplicate"),m.error(t[o.msg_id]),s();else if(o.msg_id==="login_other_white_label"){const r=U.getLabel("chromeStoreID",o.origin).config;m.error(u.jsxs(u.Fragment,{children:[t.login_other_white_label,u.jsxs("strong",{children:[r.primeiroNome," "]}),t.login_other_white_label_prt2]})),s()}else m.error(t[o.msg_id]),s()}catch(l){console.error("Error ao tentar validar o login do usuário",l)}finally{vt()}}const I=async t=>{const{language:e}=A.getState(),{config:i}=S.getState(),{login:s}=g.getState(),{close:c}=f.getState();try{const a=(await v.get(`${k.backend_plugin}api/auth/login-bearer/${i.chromeStoreID}`,{headers:{"Content-Type":"application/json",accept:"application/json","access-token":k.cript_key,Authorization:`Bearer ${t}`}})).data;if(a.success)m.success(e.login_success),s(a.user,a.auth_google,a.user_status),c();else if(a.msg_id==="login_other_white_label"){const n=U.getLabel("chromeStoreID",a.origin).config;m.error(u.jsxs(u.Fragment,{children:[e.login_other_white_label,u.jsxs("strong",{children:[n.primeiroNome," "]}),e.login_other_white_label_prt2]}))}else m.error(e[a.msg_id])}catch(a){console.error("Error ao tentar logar com o Painel Clientes",a),m.error(e.login_error_server)}},M=async()=>{chrome.storage.local.get(["redirect_painel"],({redirect_painel:t})=>{const{session:e}=g.getState();!e.is_load||e.is_auth||!t||Math.floor(Date.now()/6e4)!==t.timer||(I(t.bearer),chrome.storage.local.remove("redirect_painel"))})},Ct=S.subscribe(t=>({config:t.config}),()=>{T(),M(),Ct()},{fireImmediately:!1}),Et=g.subscribe(t=>({session:t.session}),({session:t})=>{t.is_load&&!t.is_auth&&f.getState().openRendertype("login")},{fireImmediately:!1}),F=async t=>{const{session:e}=g.getState();t.action==="license_update"&&e.user_status!=="free"&&T(),t.action==="license_free_update"&&e.user_status==="free"&&T(),t.action==="user_auth_callback"&&I(t.dados.bearer_token),t.action==="redirect_painel"&&M()};chrome.runtime.onMessage.addListener(F);window.addEventListener("beforeunload",()=>{chrome.runtime.onMessage.removeListener(F),Et()});const jt=new URLSearchParams(window.location.search),j=jt.get("color");if(j){const t=decodeURIComponent(atob(j)),{light:e,dark:i}=JSON.parse(t);if(typeof e=="object"||typeof i=="object"){const s=`
            :root {
                --primaria: ${e.primaria} !important;
                --secundaria: ${e.secundaria} !important;
                --terciaria: ${e.terciaria} !important;
            }

            .dark {
                --primaria: ${i.primaria} !important;
                --secundaria: ${i.secundaria} !important;
                --terciaria: ${i.terciaria} !important;
            }
        `,c="preview-theme",a=document.getElementById(c);a&&a.remove();const n=document.createElement("style");n.id=c,n.textContent=s,document.head.appendChild(n)}}
